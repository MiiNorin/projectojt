<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Subject List</title>
</head>
<style>
    .pagination {
        display: flex;
        justify-content: center;
        margin-top: 20px;
    }

    .pagination li {
        margin: 0 5px;
        list-style: none; /* Xóa dấu chấm */
    }

    .pagination li a {
        text-decoration: none;
        color: black;
        padding: 8px 16px;
        border: 1px solid #ddd;
        border-radius: 4px;
    }

    .pagination li.active a {
        background-color: #007bff;
        color: white;
    }

</style>
<body>
<h2>Subject List</h2>

<!-- Form để thêm mới môn học -->
<form action="/subject/addSubject" method="post" enctype="multipart/form-data">
    <input type="hidden" name="userId" id="userId" th:value="${userId}"/>
    <label for="subjectName">Subject Name:</label>
    <input type="text" id="subjectName" name="subjectName" required>

    <div class="form-group">
        <label for="imgLink">Browse Image</label>
        <div>
            <input type="file" id="imgLink" class="form-control-file" name="imageFile">
        </div>
    </div>

    <label for="slot">Slot:</label>
    <input type="number" id="slot" name="slot" required>

    <button type="submit">Add Subject</button>
</form>

<!-- Kiểm tra nếu danh sách môn học không rỗng thì hiển thị bảng danh sách và phân trang -->
<div th:if="${not #lists.isEmpty(subjects)}">
    <!-- Table để hiển thị danh sách môn học -->
    <table border="1">
        <tr>
            <th>Subject ID</th>
            <th>Subject Name</th>
            <th>Image Link</th>
            <th>Create Date</th>
            <th>Slot</th>
            <th>Action</th>
            <th>Show Question</th>
        </tr>
        <!-- Sử dụng Thymeleaf để lặp qua danh sách môn học -->
        <tr th:each="subject : ${subjects}">
            <td th:text="${subject.subjectId}"></td>
            <td th:text="${subject.subjectName}"></td>
            <td th:text="${subject.imgLink}"></td>
            <td th:text="${subject.createDate}"></td>
            <td th:text="${subject.slot}"></td>
            <td>
                <a th:href="@{'/subject/editSubject?subjectId=' + ${subject.subjectId}}">Sửa subject</a>
                <a th:href="@{'/subject/deleteSubject?id=' + ${subject.subjectId}}" onclick="return confirm('Are you sure you want to delete this question?')">Delete</a>
                <a th:href="@{/chapters/addChapter/{subjectId}(subjectId = ${subject.subjectId})}">Thêm chapter</a>
                <a th:href="@{'/chapters/showListChapter?subjectId=' + ${subject.subjectId}}">Hiển thị chapter</a>
            </td>
            <td><a th:href="@{'/questions/subject/' + ${subject.subjectId}}">Show list thuộc subject</a></td>
        </tr>
    </table>
    <div class="clearfix" th:if="${currentPage != null}">
        <ul class="pagination">

            <li th:class="${currentPage == 0} ? 'page-item disabled' : 'page-item'">
                <a th:if="${currentPage > 0}"
                   th:href="@{/subject/listSubjects/{userId}(userId=${userId}, page=0)}"
                   class="page-link">First</a>
                <span th:if="${currentPage == 0}" class="page-link">First</span>
            </li>

            <li th:class="${currentPage == 0} ? 'page-item disabled' : 'page-item'">
                <a th:if="${currentPage > 0}"
                   th:href="@{/subject/listSubjects/{userId}(userId=${userId}, page=${currentPage - 1})}"
                   class="page-link">Previous</a>
                <span th:if="${currentPage == 0}" class="page-link">Previous</span>
            </li>

            <!-- Hiển thị các số trang -->
            <li th:each="pageNumber : ${#numbers.sequence(0, totalPages - 1)}"
                th:if="${pageNumber >= currentPage - 1 and pageNumber <= currentPage + 1}"
                th:class="${pageNumber == currentPage} ? 'page-item active' : 'page-item'">
                <!-- Hiển thị trang -->
                <a th:href="@{/subject/listSubjects/{userId}(userId=${userId}, page=${pageNumber})}"
                   class="page-link" th:text="${pageNumber + 1}"></a>
            </li>


            <!-- Nút Next -->
            <li th:class="${currentPage == totalPages - 1} ? 'page-item disabled' : 'page-item'">
                <a th:if="${currentPage < totalPages - 1}"
                   th:href="@{/subject/listSubjects/{userId}(userId=${userId}, page=${currentPage + 1})}"
                   class="page-link">Next</a>
                <span th:if="${currentPage == totalPages - 1}" class="page-link">Next</span>
            </li>
            <li th:class="${currentPage == totalPages - 1} ? 'page-item disabled' : 'page-item'">
                <a th:if="${currentPage < totalPages - 1}"
                   th:href="@{/subject/listSubjects/{userId}(userId=${userId}, page=${totalPages - 1})}"
                   class="page-link">Last</a>
                <span th:if="${currentPage == totalPages - 1}" class="page-link">Last</span>
            </li>
        </ul>
    </div>
</div>
<form action="/subject/searchByName" method="get"> <!-- Chỉnh sửa action của form -->
    <input type="text" name="searchName" placeholder="Search by name" th:value="${searchName}">
    <input type="hidden" id="userId" name="userId" th:value="${userId}"/>
    <button type="submit">Search</button>
</form>

<a th:href="@{/subject/listSubjects/{userId}(userId=${userId})}">Back to list</a>
</body>
</html>
