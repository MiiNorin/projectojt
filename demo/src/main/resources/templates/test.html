<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Random Questions Test</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto&display=swap">


    <style>
        .panel-understanding-check {
            background: #f6f7fb;
            padding: 1.5rem;
        }
        ul {
            list-style-type: none;
            padding: 0;
        }
        li {
            margin-bottom: 10px;
        }
        body {
            font-family: 'Roboto', sans-serif;
        }
        label.questioncontext {
            margin: 30px 0px 18px 0px;
            font-weight: bold;
        }
        label.duration {
            border: 1px solid #ccc;
            padding: 5px 10px;
            border-radius: 5px;
        }
    </style>
</head>
<body>

<div class="container">

    <div class="col text-center">
        <h1 th:text="${topicName}"></h1>
    </div>
    <div class="col text-right">
        <div class="time">
            <label class="duration"><span id="timer"></span></label>
            <input type="hidden" id="duration" name="duration" th:value="${duration}">
        </div>
    </div>

    <div class="card panel-understanding-check">
        <div class="card-body">
            <form id="quizForm" action="/questiontests/submitAnswers" method="post">
                <div id="questionContainer">
                    <div th:each="question : ${questions}">
                        <label class="questioncontext" th:text="${question.questionContext}"></label>
                        <ul>
                            <li th:if="${not #strings.isEmpty(question.optionA)}">
                                <input type="radio" th:name="'answerId' + ${question.questionId}" value="1" />
                                <span th:text="${question.optionA}"></span>
                            </li>
                            <li th:if="${not #strings.isEmpty(question.optionB)}">
                                <input type="radio" th:name="'answerId' + ${question.questionId}" value="2" />
                                <span th:text="${question.optionB}"></span>
                            </li>
                            <li th:if="${not #strings.isEmpty(question.optionC)}">
                                <input type="radio" th:name="'answerId' + ${question.questionId}" value="3" />
                                <span th:text="${question.optionC}"></span>
                            </li>
                            <li th:if="${not #strings.isEmpty(question.optionD)}">
                                <input type="radio" th:name="'answerId' + ${question.questionId}" value="4" />
                                <span th:text="${question.optionD}"></span>
                            </li>
                        </ul>

                        <input type="hidden" class="questionId" name="questionId" th:value="${question.questionId}" />
                        <input type="hidden" class="selectedAnswer" name="selectedAnswer" />
                        <input type="hidden" class="testDetailId" name="testDetailId" th:value="${testDetailId}"/>
                    </div>
                </div>
                <div class="text-center">
                    <input type="submit" value="Submit" class="btn btn-primary">
                </div>
            </form>
            <div class="pagination" id="pagination">

            </div>
        </div>
    </div>
</div>


<script>

    document.getElementById('quizForm').addEventListener('submit', function(event) {
        var selectedAnswers = [];
        var radioInputs = document.querySelectorAll('input[type="radio"]');
        var atLeastOneSelected = false;

        radioInputs.forEach(function(input) {
            if (input.checked) {
                var selectedAnswer = input.value;
                selectedAnswers.push(selectedAnswer);
                atLeastOneSelected = true;
            }
        });

        if (!atLeastOneSelected) {
            selectedAnswers.push("5");
        }

        document.querySelector('.selectedAnswer').value = selectedAnswers.join(',');
    });

    var durationInput = document.getElementById('duration');
    var timerDisplay = document.getElementById('timer');
    var quizForm = document.getElementById('quizForm');
    var radioInputs = document.querySelectorAll('input[type="radio"]');

    // Khởi tạo thời gian từ input hidden
    var duration = parseInt(durationInput.value);
    var endTime = Date.now() + duration * 1000*60;

    // Cập nhật thời gian sau mỗi giây
    var timer = setInterval(updateTimer, 1000);

    // Hàm cập nhật thời gian
    function updateTimer() {
        var now = Date.now();
        var timeLeft = Math.max(0, Math.ceil((endTime - now) / 1000));
        var minutes = Math.floor(timeLeft / 60);
        var seconds = timeLeft % 60;
        var formattedTime = ("0" + minutes).slice(-2) + ":" + ("0" + seconds).slice(-2);
        timerDisplay.textContent = formattedTime;
        if (timeLeft === 0) {
            clearInterval(timer);
            quizForm.submit();
        }
    }

    ipt>
    // Chờ sau 3 giây trước khi chuyển hướng
    setTimeout(function() {
        window.location.href = "redirect:/home/homePage";
    }, 3000);

    // Thêm sự kiện click cho các input radio
    radioInputs.forEach(function(input) {
        input.addEventListener('click', function() {
            var selectedAnswers = [];
            radioInputs.forEach(function(input) {
                if (input.checked) {
                    var selectedAnswer = input.value;
                    selectedAnswers.push(selectedAnswer);
                }
            });
            document.querySelector('.selectedAnswer').value = selectedAnswers.join(',');
        });
    });
</script>


</body>
</html>