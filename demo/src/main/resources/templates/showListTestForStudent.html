<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <title>List of Topics</title>
    <style>
        .topic-card {
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 10px;
            cursor: pointer;
        }

        .topic-card:hover {
            background-color: #f0f0f0;
        }
    </style>
</head>
<body>
<h1>List of Topics</h1>
<h3>Chapter <span th:text="${chapter.chapterName}"></span></h3>

<table border="1">
    <thead>
    <tr>
        <th>Tên test</th>
        <th>Làm bài test</th>
        <th>Status</th>
        <th>Số câu hỏi</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="topic : ${topics}">
        <input type="hidden" name="subjectId" th:value="${subjectId}"/>
        <input type="hidden" name="chapterId" th:value="${chapterId}"/>
        <td th:text="${topic.topicName}"></td>
        <td>
            <span th:if="${(topic.status != 'Finished') and (topic.status!='Soon')}">
                <a class="topic-link" href="#"
                   th:data-topic-id="${topic.topicId}"
                   th:data-total-question="${topic.totalQuestion}"
                   data-toggle="modal" data-target="#myModal"
                   th:text="${topic.topicName}">Làm bài test</a>
            </span>
            <span th:unless="${(topic.status != 'Finished') and (topic.status!='Soon')}" th:text="${topic.topicName}"></span>
        </td>
        <td class="topic-status" th:data-status="${topic.status}" th:text="${topic.status}"></td>
        <td th:text="${totalQuestions}"></td>
    </tr>
    </tbody>
</table>

<a th:href="@{'/chapters/chooseChapter?subjectId=' + ${subjectId}}">Về lại Chapter List</a>

<!-- The Modal -->
<div class="modal fade" id="myModal" role="dialog">
    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Modal Header</h4>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to proceed to the test?</p>
            </div>
            <div class="form-group">
                <label for="hardQuestion">Chọn câu hỏi khó:</label>
                <input type="number" class="form-control" id="hardQuestion" value="0" th:max="${totalQuestion}">
            </div>
            <input type="hidden" id="totalHardQuestion" name="totalHardQuestion">
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <button id="okBtn" type="button" class="btn btn-primary">OK</button>
            </div>
        </div>

    </div>
</div>

<script>
    document.querySelectorAll('.topic-link').forEach(link => {
        link.addEventListener('click', function (event) {
            const status = this.closest('tr').querySelector('.topic-status').getAttribute('data-status');
            if (status === 'Finished') {
                event.preventDefault();
                alert('This topic is already finished.');
            }
        });
    });

    // Handling click on "OK" button
    document.getElementById("okBtn").addEventListener("click", function () {
        const topicId = document.querySelector('.topic-link').getAttribute("data-topic-id");
        const totalQuestion = document.querySelector('.topic-link').getAttribute("data-total-question");
        let totalHardQuestion = parseInt(document.getElementById("hardQuestion").value); // Lấy giá trị từ trường "Chọn câu hỏi khó"

        if (totalHardQuestion < 0) {
            totalHardQuestion = 0;
        } else if (totalHardQuestion > totalQuestion) {
            totalHardQuestion = totalQuestion;
        }

        document.getElementById("totalHardQuestion").value = totalHardQuestion;
        window.location.href = "/test/" + topicId + "/" + totalQuestion + "?totalHardQuestion=" + totalHardQuestion;
    });
    document.getElementById("hardQuestion").addEventListener("input", function() {
        if (this.value < 0) {
            this.value = 0;
        }
    });
</script>

</body>
</html>
